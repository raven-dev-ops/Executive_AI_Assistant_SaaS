global:
  resolve_timeout: 5m

route:
  receiver: slack-notifications
  routes:
    - matchers:
        - severity="critical"
        - page="true"
      receiver: pager-notifications
    - matchers:
        - severity="warning"
      receiver: slack-notifications

receivers:
  - name: slack-notifications
    slack_configs:
      - api_url: https://hooks.slack.com/services/REPLACE/ME
        channel: "#ai-telephony-alerts"
        send_resolved: true
        title: |-
          [{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} ({{ .CommonLabels.severity }})
        text: |-
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
          *Labels:* {{ .CommonLabels }}

  - name: pager-notifications
    email_configs:
      - to: oncall@yourcompany.com
        from: alertmanager@yourcompany.com
        smarthost: smtp.yourcompany.com:587
        auth_username: alertmanager@yourcompany.com
        auth_password: REPLACE_WITH_APP_PASSWORD
        send_resolved: true
        headers:
          subject: "[PAGE] {{ .CommonLabels.alertname }} ({{ .CommonLabels.severity }})"
    slack_configs:
      - api_url: https://hooks.slack.com/services/REPLACE/ME
        channel: "#ai-telephony-oncall"
        send_resolved: true
        title: |-
          [PAGE][{{ .Status | toUpper }}] {{ .CommonLabels.alertname }} ({{ .CommonLabels.severity }})
        text: |-
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
          *Labels:* {{ .CommonLabels }}

inhibit_rules:
  - source_matchers:
      - severity="critical"
    target_matchers:
      - severity="warning"
    equal: ["alertname"]
